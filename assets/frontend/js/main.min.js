!function(e){"use strict";const t=window.flexify_checkout_params||{},o={Validations:{onChange:function(){var e=document.querySelectorAll(".form-row input, .form-row select, .form-row textarea");Array.from(e).forEach((function(e){e.addEventListener("change input",(function(t){return t.preventDefault(),o.Validations.getFieldErrors(e),!1}))}))},isValidEmail:function(e){return e.match(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/)},getFieldErrors:async function(i){var n=i.closest(".form-row");if(!n||!n.attributes["data-label"]||!n.attributes["data-type"])return!1;var r=n.attributes["data-type"].value,s=document.getElementById("billing_country");try{if(["country","postcode","phone","email","text"].includes(r)){const a=(await new Promise(((a,c)=>{e.ajax({type:"POST",url:t.ajax_url,data:{action:"flexify_check_for_inline_error",args:{label:n.attributes["data-label"].value,required:n.classList.contains("required"),type:r},country:s?s.value:"",key:i.attributes.name.value,value:o.Helpers.getFieldValue(i)},success:function(e){a(e)},error:function(e,t,o){c(o)}})}))).data,c=a.input_id.replace("billing_","");if(e(".flexify-review-customer__content").find(".customer-details-info."+c).text(a.input_value),n.querySelector(".error").innerHTML=a.message,n.classList.remove("woocommerce-invalid"),n.classList.contains("validate-required")&&e(i).trigger("validate"),a.isCustom&&n.classList.add("woocommerce-invalid"),"info"===a.messageType){n.querySelector(".info")||n.insertAdjacentHTML("beforeend",'<span class="info" style="display:none"></span>');e(n).find(".info").html(a.message).slideDown(),"yes"===t.auto_display_login_modal&&o.loginForm.openModal(!0)}else e(n).find(".info").slideUp()}else n.classList.contains("validate-required")&&e(i).trigger("validate")}catch(e){console.error("[FLEXIFY CHECKOUT] Error validating field:",e)}const a=n.classList.contains("woocommerce-invalid");return a&&o.Steps.disableNextSteppers(n.getAttribute("data-step")),o.Validations.accessibleErrors(),a},clearErrorMessages:function(t){e(".woocommerce-notices-wrapper > div, .woocommerce-notices-wrapper ul").each((function(){t?e(this).attr(t)&&e(this).remove():e(this).remove()})),e(".woocommerce-NoticeGroup").remove()},scrollToError:function(){let e=document.querySelectorAll(".woocommerce-invalid")[0];e&&e.scrollIntoView({behavior:"smooth"})},accessibleErrors:function(){let e=document.querySelectorAll(".form-row input, .form-row select, .form-row textarea");Array.from(e).forEach((function(e){const t=e.closest(".form-row");if(!t)return;const o=t.querySelector(".error");o&&(o.setAttribute("aria-hidden","true"),o.setAttribute("aria-live","off")),t.classList.contains("woocommerce-invalid")&&(e.setAttribute("aria-invalid","true"),o&&(o.setAttribute("aria-hidden","false"),o.setAttribute("aria-live","polite")))}))},isHiddenConditionalField:function(t){const o=e(t).closest(".form-row");return o.is(":hidden")&&o.hasClass("wooccm-conditional-child")||o.hasClass("temp-hidden")},displayGlobalNotices:function(e,t,o,i){t||(t="error"),o||(o="list");var n=document.querySelector(".woocommerce-notices-wrapper");if(n){var r=document.createElement("div"),s="woocommerce-error";if("error"!==t&&(s="woocommerce-message"),"info"===t&&(s="woocommerce-info"),"object"!=typeof i||Array.isArray(i)||null===i||Object.entries(i).forEach((function(e){var t=e[0],o=e[1];r.setAttribute(t,o)})),"list"===o){r.classList.add("woocommerce-NoticeGroup"),r.classList.add("woocommerce-NoticeGroup-checkout");var a=document.createElement("ul");a.setAttribute("role","alert"),a.classList.add(s);var c=document.createElement("li");c.innerHTML=e,a.append(c),r.append(a)}else r.setAttribute("role","alert"),r.classList.add(s),r.innerHTML=e;n.append(r)}},validateSearchForm:function(){var e=document.querySelectorAll("#billing_address_search");Array.from(e).forEach((function(e){var i=e.closest(".woocommerce-billing-fields__wrapper").querySelector(".woocommerce-billing-fields");if("none"===window.getComputedStyle(i).display){o.Validations.displayGlobalNotices(t.i18n.errorAddressSearch),Array.from(e.closest(".form-row").querySelectorAll(".error")).forEach((function(e){e.remove()}));var n=e.closest(".form-row");n.classList.add("woocommerce-invalid");var r=document.createElement("span");r.setAttribute("aria-hidden","false"),r.setAttribute("aria-live","polite"),r.classList.add("error"),r.innerHTML=t.i18n.errorAddressSearch,n.append(r)}}))},checkFieldsForErrors:async function(i){const n={},r=[];i.forEach((t=>{if(!t)return;const i=t.closest(".form-row");i&&t.name&&i.dataset.label&&i.dataset.type&&(n[t.name]={args:{label:i.dataset.label,required:i.classList.contains("required"),type:i.dataset.type},country:e("#billing_country").val()||"",key:t.name,value:o.Helpers.getFieldValue(t)})}));try{const i=(await new Promise(((o,i)=>{e.ajax({type:"POST",url:t.ajax_url,data:{action:"flexify_check_for_inline_errors",fields:n,email:e("#billing_email").val()},success:function(e){o(e)},error:function(e,t,o){i(o)}})}))).data;Object.entries(i).forEach((([t,i])=>{const n=document.querySelector(`[name="${t}"]`);if(!n||o.Validations.isHiddenConditionalField(n))return;e(".flexify-review-customer__content").find(".customer-details-info."+i.input_id.replace("billing_","")).text(i.input_value);const s=n.closest(".form-row");s.querySelector(".error").innerHTML=i.message,s.classList.remove("woocommerce-invalid"),s.classList.contains("validate-required")&&e(n).trigger("validate").trigger("flexify_validate"),i.isCustom&&s.classList.add("woocommerce-invalid"),s.classList.contains("woocommerce-invalid")&&r.push(t)})),o.Components.updateFragments(i.fragments)}catch(e){console.error("[FLEXIFY CHECKOUT] AJAX error on check field errors:",e)}if(o.Validations.clearErrorMessages("data-flexify-error"),o.Validations.accessibleErrors(),r.length){const e=i[0].closest("[data-step]").dataset.step;document.querySelector(`[data-stepper-li="${e}"]`).classList.add("error"),o.Steps.disableNextSteppers(+e),o.Validations.scrollToError(),o.Validations.validateSearchForm(),o.Shippings.maybeShowShippingForm(r)}return!!r.length&&r},addMaskOnFields:function(){if("yes"!==t.enable_field_masks)return;const o=t.get_input_masks||{};e.each(o,(function(o,i){const n=e("#"+o);0!==n.length&&(n.data("mask-applied")||("function"==typeof n.unmask&&n.unmask(),"function"==typeof n.mask&&(n.mask(i),n.data("mask-applied",!0)),"yes"===t.international_phone&&"billing_phone"===o&&(n.unmask(),n.removeData("mask-applied"))))}))},validateInternationalPhone:function(o){const i=e(this),n=i.val().trim(),r=i.closest(".form-row"),s=i.data("itiInstance");!r.hasClass("has-changed")&&n.length<4?r.removeClass("woocommerce-validated woocommerce-invalid"):s&&s.promise&&s.promise.then((()=>{s.isValidNumber()?r.removeClass("woocommerce-invalid woocommerce-invalid-phone"):r.removeClass("woocommerce-validated").addClass("woocommerce-invalid woocommerce-invalid-phone").find(".error").text(t.i18n.phone.invalid)}))},markInternationalPhoneChanged:function(t){e(this).val().trim()&&e(this).closest(".form-row").addClass("has-changed")},init:function(){this.onChange();let t=e("#billing_email").val();t&&o.Validations.isValidEmail(t)&&o.Validations.getFieldErrors(document.getElementById("billing_email")),o.Validations.addMaskOnFields()}},Sidebar:{addQuantityControls:function(){var t=document.querySelectorAll('.quantity input[type="number"]');Array.from(t).forEach((function(t){var o=t.closest(".quantity");if(0<e(o).find(".quantity__button").length)return;let i=document.createElement("button");i.setAttribute("type","button"),i.classList.add("quantity__button"),i.classList.add("quantity__button--minus"),i.innerHTML="-",o.prepend(i),i.addEventListener("click",(function(){t.value=parseInt(t.value)-1,t.dispatchEvent(new Event("change"))}));let n=document.createElement("button");n.setAttribute("type","button"),n.classList.add("quantity__button"),n.classList.add("quantity__button--plus"),n.innerHTML="+",o.appendChild(n),n.addEventListener("click",(function(){t.value=parseInt(t.value)+1,t.dispatchEvent(new Event("change"))})),t.addEventListener("change",(async function(t){return t.preventDefault(),e("body").trigger("update_checkout"),!1}))})),e('.quantity input[type="number"]').on("focusin",(function(){e(this).closest(".quantity").addClass("quantity--on-focus")})),e('.quantity input[type="number"]').on("focusout",(function(){e(this).closest(".quantity").removeClass("quantity--on-focus")}))},moveShippingRow:function(){if(o.Helpers.isModernCheckout()){e(".woocommerce-checkout-review-order-table .woocommerce-shipping-totals").length&&e(".flexify-checkout__shipping-table tbody").html("");var t=e(".flexify-checkout__content-right tr.woocommerce-shipping-totals.shipping");t.length&&e(".flexify-step--address .flexify-checkout__shipping-table > tbody").html(t)}},updateCartCount:function(){var t=0;e(".quantity input.qty").each((function(){t+=parseInt(e(this).val(),10)}));const o=e(".order_review_heading__count");o.length&&o.html(t)},updateSidebarTotal:function(){const t=e(".order-total td:last-of-type").html();e(".flexify-checkout__sidebar-header-total").html(t)},autoToggleOrderSummary:function(){var e=document.querySelector(".flexify-checkout__sidebar-header");e&&e.click()},orderSummaryToggle:function(e){if(o.Helpers.isMobile()){var t=document.querySelector(".flexify-checkout__sidebar-header-link--hide"),i=document.querySelector(".flexify-checkout__sidebar-header-link--show"),n=document.querySelector(".flexify-checkout__order-review");if(o.Helpers.isModernCheckout()&&(n=document.querySelector(".flexify-checkout__content-right")),t&&n)"none"===window.getComputedStyle(t).display?(t.style.display="block",i.style.display="none",!0===e?n.style.display="block":o.UI.slideDown(n),o.UI.slideDown(n)):(t.style.display="none",i.style.display="block",!0===e?n.style.display="none":o.UI.slideUp(n))}},orderSummaryResize:function(){var t=e(".flexify-checkout__order-review");o.Helpers.isModernCheckout()&&(t=e(".flexify-checkout__content-right")),o.Helpers.isMobile()||!t.is(":hidden")||t.show()},init:function(){this.addQuantityControls(),this.moveShippingRow();var i=document.querySelector(".flexify-checkout__sidebar-header");let n;i&&i.addEventListener("click",o.Sidebar.orderSummaryToggle),e(window).on("resize",o.Sidebar.orderSummaryResize),"yes"===t.opened_default_order_summary&&(o.Sidebar.orderSummaryToggle(!0),o.Sidebar.autoToggleOrderSummary()),e(window).on("resize",(function(){clearTimeout(n),n=setTimeout(o.Sidebar.moveShippingRow,250)}))}},processCheckout:{cache:{button_html:""},onClick:function(){e(document).on("click","#place_order",(function(i){i.preventDefault(),o.Animations.preparePlaceOrderButton(),e("#place_order").addClass("flexify-checkout-btn-loading"),"yes"===t.enable_animation_process_purchase&&o.Animations.purchaseAnimation.start(),e("#place_order").closest("form").submit()}))},onSelectPaymentMethod:function(){e(document.body).on("payment_method_selected",(function(){let t=o.processCheckout.cache.button_html;t&&"paypal"!==e("[name='payment_method']:checked").val()&&e("#place_order").html(t)}))},onPlaceOrder:function(){e("form.checkout").on("checkout_place_order",(function(){o.Conditions.checkFieldVisibility()}))},onSubmitCheckoutForm:function(){e("form.checkout").submit((function(){o.Conditions.checkFieldVisibility()}))},init:function(){e("#payment_method_stripe").length||(this.onClick(),this.onSelectPaymentMethod(),this.onPlaceOrder(),this.onSubmitCheckoutForm())}},Triggers:{onUpdatedCheckout:function(){e(document.body).on("updated_checkout",(function(i,n){n.fragments.flexify.total&&(o.processCheckout.cache.button_html=`${t.i18n.pay} ${n.fragments.flexify.total}`,e("#place_order").html(o.processCheckout.cache.button_html)),n?.fragments&&o.Components.updateFragments(n),o.Helpers.isModernCheckout()&&o.Shippings.addShippingRowOnSummary(n),n?.fragments?.flexify?.global_error&&o.Validations.displayGlobalNotices(n.fragments.flexify.global_error),n?.fragments?.flexify?.empty_cart&&(e(".flexify-checkout").append(n.fragments.flexify.empty_cart),setTimeout((()=>{window.location=t.shop_page}),3e3)),o.Shippings.selectShippingMethod(),o.Helpers.removeDomElements(),o.Sidebar.init(),o.Sidebar.updateSidebarTotal()}))},onCheckoutError:function(){e(document.body).on("checkout_error",(function(i,n){e("#place_order").removeClass("flexify-checkout-btn-loading"),o.Helpers.removeDomElements(),e(".woocommerce-notices-wrapper").html(""),o.Components.addNotice(n),o.Animations.purchaseAnimation.stop(),t.debug_mode&&console.log("[FLEXIFY CHECKOUT] - Checkout error: ",n)}))},onFragmentsUpdated:function(){e(document.body).on("wc_fragments_refreshed",(function(){o.Helpers.removeDomElements(),o.Sidebar.init(),o.Sidebar.updateSidebarTotal()}))},onSelectShippingMethod:function(){e(document).on("click",".shipping-method-item",(function(t){e(t.target).is("input")||e(t.target).is("label")||(o.Shippings.selectShippingMethod(),e(this).find('input[type="radio"]').prop("checked",!0).trigger("change"))})),e(document).on("change","input.shipping_method",(function(){o.Shippings.selectShippingMethod()})),e(document.body).on("change","input.shipping_method",(function(){o.Shippings.selectShippingMethod(),o.Sidebar.updateSidebarTotal()}))},removeProductItem:function(){e(document).on("click",".flexify-remove-item",(function(i){i.preventDefault();const n=e(this),r=n.closest(".cart_item"),s=n.data("product_id"),a=n.data("cart_item_key");a&&e.ajax({url:t.ajax_url,method:"POST",data:{action:"flexify_checkout_remove_product",product_id:s,cart_item_key:a,nonce:t.nonces.remove_product},beforeSend:function(){o.UI.togglePlaceholder(r,!0),n.prop("disabled",!0)},success:function(t){t.success?(r.fadeOut(300,(function(){e(this).remove()})),t.data.notice_html&&o.Components.addNotice(t.data.notice_html),e(document.body).trigger("update_checkout")):console.warn(t.data?.message||"Error on remove product.")},error:function(e,t,o){console.error("[FLEXIFY CHECKOUT] AJAX error on try remove product item:",t,o)},complete:function(){o.UI.togglePlaceholder(r,!1),n.prop("disabled",!1)}})}))},undoRemoveProduct:function(){e(document).on("click",".undo-remove-product",(function(o){o.preventDefault();const i=e(this),n=i.data("product_id");i.closest(".flexify-checkout-notice").fadeOut(300,(function(){e(this).remove()})),e.ajax({url:t.ajax_url,method:"POST",data:{action:"flexify_checkout_undo_remove_product",product_id:n,nonce:t.nonces.undo_remove_product},beforeSend:function(){e(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},success:function(t){t.success&&(e(".woocommerce-checkout-review-order-table").unblock(),e(document.body).trigger("update_checkout"))},error:function(e,t,o){console.error("[FLEXIFY CHECKOUT] AJAX error on try undo remove product item:",t,o)}})}))},init:function(){o.Helpers.removeDomElements(),this.onUpdatedCheckout(),this.onCheckoutError(),this.onFragmentsUpdated(),this.onSelectShippingMethod(),this.removeProductItem(),this.undoRemoveProduct(),e(document.body).trigger("country_to_state_changed")}},Coupons:{onClick:function(){var e=document.querySelectorAll("[data-show-coupon]");Array.from(e).forEach((function(e){e.setAttribute("type","button"),e.addEventListener("click",(function(e){e.preventDefault();var t=e.target.closest(".woocommerce-form-coupon__wrapper").querySelector(".woocommerce-form-coupon");return"none"===t.style.display?o.UI.slideDown(t):o.UI.slideUp(t),!1}))}))},onChange:function(){e(document).on("keyup","#coupon_code",(function(){const t=e(this).closest(".checkout_coupon").find(".flexify-coupon-button");e(this).val().trim()?t.removeClass("flexify-coupon-button--disabled"):t.addClass("flexify-coupon-button--disabled")}))},applyCoupon:function(){e(document).on("click","button[name=apply_coupon]",(function(t){t.preventDefault();let i=e(this),n=o.Helpers.keepButtonState(i);const r=i.closest(".woocommerce-form-coupon__wrapper");e(".woocommerce-form-coupon__wrapper").find(".error, .success").remove(),e.ajax({type:"POST",url:wc_checkout_params.wc_ajax_url.toString().replace("%%endpoint%%","apply_coupon"),data:{action:"apply_coupon",coupon_code:r.find('input[name="coupon_code"]').val(),security:wc_checkout_params.apply_coupon_nonce},contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"html",beforeSend:function(){i.prop("disabled",!0).html('<span class="flexify-btn-processing-inline"></span>')},success:function(t){const o=e("<div>").html(t);let i="",n="success";o.find(".woocommerce-error li").length?(i=o.find(".woocommerce-error li").text().trim(),n="error"):o.find(".woocommerce-message li").length&&(i=o.find(".woocommerce-message li").text().trim(),n="success"),e(document.body).trigger("update_checkout"),e(document.body).one("updated_checkout",(function(){i&&e(".woocommerce-form-coupon__inner").append(`<div class="flexify-coupon-notice ${n}" aria-hidden="false" aria-live="polite">${i}</div>`)}))},error:function(e,t,o){console.error("[FLEXIFY CHECKOUT] AJAX error on applying coupon:",t,o)},complete:function(){i.html(n.html).prop("disabled",!1),o.Components.removeSpinner(i)}})}))},removeCoupon:function(){e(document.body).off("click",".woocommerce-remove-coupon"),e(document.body).on("click",".woocommerce-remove-coupon",(function(o){o.preventDefault();let i=e(this).data("coupon");e.ajax({type:"POST",url:wc_checkout_params.wc_ajax_url.toString().replace("%%endpoint%%","remove_coupon"),data:{security:wc_checkout_params.remove_coupon_nonce,coupon:i},dataType:"html",success:function(o){e(".woocommerce-error, .woocommerce-message").remove(),e(".woocommerce-form-coupon__wrapper").find(".error, .success").remove(),o&&(e(document.body).trigger("removed_coupon_in_checkout",[i]),e(document.body).trigger("update_checkout"),e(document.body).one("updated_checkout",(function(){e(".woocommerce-form-coupon__inner .form-row-first").append(`<div class="success" aria-hidden="false" aria-live="polite">${t.i18n.coupon_success}</div>`)})),e("form.checkout_coupon").find('input[name="coupon_code"]').val(""))},error:function(e,t,o){console.error("[FLEXIFY CHECKOUT] AJAX error on remove coupon:",t,o)}})}))},init:function(){this.onClick(),this.applyCoupon(),this.onChange(),this.removeCoupon(),e(".flexify-checkout--has-sidebar")[0]&&(e(document.body).on("wc_fragments_refreshed",(function(){o.Coupons.onClick()})),e(document.body).on("updated_checkout",(function(){o.Coupons.onClick()})),e(document).on("keydown","#coupon_code",(function(t){"Enter"!==t.key&&13!==t.keyCode||(e("[name=apply_coupon]").trigger("click"),t.preventDefault())})),setTimeout(o.Coupons.removeCoupon,100))}},Helpers:{keepButtonState:function(e){var t=e.width(),o=e.height(),i=e.html();return e.width(t),e.height(o),{width:t,height:o,html:i}},isModernCheckout:function(){return document.querySelectorAll(".flexify-checkout--modern").length},isMobile:function(){return e(window).width()<1024},getFieldValue:function(e){return e.value},setCookie:function(e,t,o){let i="";if(o){let e=new Date;e.setTime(e.getTime()+24*o*60*60*1e3),i="; expires="+e.toUTCString()}document.cookie=e+"="+encodeURIComponent(t)+i+"; path=/"},getCookie:function(e){let t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.\$?*|{}\(\)\[\]\/+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},deleteCookie:function(e){document.cookie=e+"=; Max-Age=0; path=/; domain="+window.location.hostname},removeDomElements:function(){const t=document.querySelector(".woocommerce-form-login-toggle"),i=document.querySelector(".shopkeeper_checkout_login");t&&t.remove(),i&&i.remove();const n=e(".flexify-checkout__steps .woocommerce-notices-wrapper");n.length>1&&n.slice(1).remove(),o.Helpers.repositionNotices()},repositionNotices:function(){const t=o.Helpers.isModernCheckout(),i=document.querySelector("form.woocommerce-checkout > .woocommerce-NoticeGroup.woocommerce-NoticeGroup-checkout"),n=e(".woocommerce-notices-wrapper");if(t&&i){var r=i.querySelector(".woocommerce-error");if(!r)return;n.append(r),i.remove()}t&&n&&n.prependTo(".flexify-checkout__steps")}},localStorage:{loadData:function(){const e=localStorage.getItem("flexify_checkout_form_data"),o=document.querySelector("form.checkout");if(!e||!o)return;let i;try{i=JSON.parse(e)}catch{return}const n=t.localstorage_fields||[];Object.entries(i).forEach((([e,t])=>{if(!n.includes(e))return;const i=o.elements[e];if(i&&null!=t&&("string"==typeof t||"number"==typeof t)){if("checkbox"===i.type)i.checked="on"===t;else if("SELECT"===i.tagName)[...i.options].some((e=>e.value===String(t)))&&(i.value=String(t));else if("radio"===i.type){o.querySelectorAll(`input[name="${CSS.escape(e)}"][type="radio"]`).forEach((e=>e.checked=e.value===String(t)))}else i.value=String(t);i.dispatchEvent(new Event("change",{bubbles:!0}))}}))},onChange:function(e){const o=e.target.closest("form.checkout");if(!o)return;const i={},n=t.localstorage_fields||[];Array.from(o.elements).forEach((e=>{if(!e.name||!n.includes(e.name))return;let t;if("checkbox"===e.type)t=e.checked?"on":"";else if("radio"===e.type){if(!e.checked)return;t=e.value}else t=e.value;null==t||"string"!=typeof t&&"number"!=typeof t||(i[e.name]=String(t))})),localStorage.setItem("flexify_checkout_form_data",JSON.stringify(i))},init:function(){const e=document.querySelector("form.checkout");e&&(e.addEventListener("change",this.onChange.bind(this)),this.loadData())}},loginForm:{showNotice:function(t,o){o||(o="error");var i=e(".flexify-login-notice"),n=`flexify-login-notice--${o}`;i.removeClass("flexify-login-notice--success flexify-login-notice--error flexify-login-notice--info"),i.addClass(n),i.html(t)},openModal:function(i){let n=e("#billing_email").val();n&&e(".woocommerce-form-login #username").val(n).trigger("change"),i&&o.loginForm.showNotice(t.i18n.account_exists,"info"),window.setTimeout((function(){e(".woocommerce-form-login #password").focus().trigger("focus")}),300),e.magnificPopup.open({items:{src:".woocommerce-form-login",type:"inline"}})},onClick:function(){setTimeout((()=>{e(document.body).off("click","a.showlogin")}),100),e(document).on("click","[data-login], .showlogin",(function(e){e.preventDefault(),o.loginForm.openModal()}))},passwordVisibility:function(){e(".toggle-password-visibility .toggle").on("click",(function(){var t=e(".flexify-login-password"),o=e(".toggle-password-visibility .show-password"),i=e(".toggle-password-visibility .hide-password");"password"===t.attr("type")?(t.attr("type","text"),o.hide(),i.show()):(t.attr("type","password"),o.show(),i.hide())}))},onSubmit:function(i){i.preventDefault();const n=e(".woocommerce-form-login");let r=e(".flexify-button.woocommerce-button.button.woocommerce-form-login__submit"),s=o.Helpers.keepButtonState(r);e.ajax({type:"POST",url:t.ajax_url,data:{action:"flexify_checkout_login",username:n.find("#username").val(),password:n.find("#password").val(),remember:n.find("#rememberme").val(),_wpnonce:n.find("#woocommerce-login-nonce").val()},beforeSend:function(){r.prop("disabled",!0).html('<span class="flexify-btn-processing-inline"></span>')},success:function(e){e.success?(o.loginForm.showNotice(t.i18n.login_successful,"success"),r.prop("disabled",!0).addClass("btn-success").html('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill:#fff"><path d="m10 15.586-3.293-3.293-1.414 1.414L10 18.414l9.707-9.707-1.414-1.414z"/></svg>'),window.location.reload()):o.loginForm.showNotice(e.data.error,"error")},error:function(e,i,n){console.error("[FLEXIFY CHECKOUT] AJAX error on try login user:",i,n),o.loginForm.showNotice(t.i18n.error,"error")},complete:function(){r.html(s.html).prop("disabled",!0)}})},init:function(){this.onClick(),this.passwordVisibility(),e(".woocommerce-form-login").hasClass("woocommerce-form-login--auto-open")&&window.setTimeout((function(){o.loginForm.openModal()}),1e3),e(".woocommerce-form-login > h2:first").append('<div class="flexify-login-notice"></div>'),e(".woocommerce-form-login").on("submit",o.loginForm.onSubmit)}},Animations:{preparePlaceOrderButton:function(){if(e("#place_order").find(".flexify-submit-dots").length)return;let t=e("#place_order").html();e("#place_order").html(t+'<span class="flexify-submit-dots">\n                    <i class="flexify-submit-dot flexify-submit-dot__1"></i>\n                    <i class="flexify-submit-dot flexify-submit-dot__1"></i>\n                    <i class="flexify-submit-dot flexify-submit-dot__1"></i>\n                </span>')},purchaseAnimation:function(){let t=1;let o,i,n=0,r=!1;const s=function(){const i=e("#flexify_checkout_purchase_animation");clearInterval(o),o=setInterval((()=>{i.find(".purchase-animation-item").removeClass("active");const e=i.find(`.purchase-animation-item.animation-${t}`);e.addClass("active");const o=e.find("lord-icon")[0];o&&o.playerInstance&&o.playerInstance.playFromBeginning(),t=t%3+1}),2e3)},a=function(e){const t=Math.floor(11*Math.random())+15;n+=t,n>95&&(n=95,clearInterval(i)),e.css("width",`${n}%`)},c=function(){t=1,n=0,clearInterval(o),clearInterval(i)};return{start:function(){const t=e("#flexify_checkout_purchase_animation"),o=t.find(".animation-progress-bar");r||(r=!0,c(),o.css("width","0%"),t.addClass("active"),setTimeout((()=>{e(".woocommerce-checkout.processing").find(".blockOverlay").css("display","none")}),10),s(),i=setInterval((()=>{a(o)}),1200))},stop:function(){const t=e("#flexify_checkout_purchase_animation"),s=t.find(".animation-progress-bar");clearInterval(o),clearInterval(i),r=!1,n=0,s.css("width","0%"),t.find(".purchase-animation-item").removeClass("active"),t.removeClass("active")}}}()},Steps:{steps_hash:t.steps,getFields:function(t){var o=e(t),i=o.find(".create-account input, .create-account select, .create-account textarea"),n=o.find(".woocommerce-shipping-fields input, .woocommerce-shipping-fields select, .woocommerce-shipping-fields textarea"),r=o.find(".woocommerce-additional-fields input, .woocommerce-additional-fields select, .woocommerce-additional-fields textarea"),s=[];return o.find("input, select, textarea").each((function(){var t=e(this);(o.find("input[name=createaccount]:checked").length||o.find(".create-account").filter((function(){return"block"===e(this).css("display")})).length||!i.is(t))&&(!o.find("input[name=ship_to_different_address]:checked").length&&n.is(t)||!o.find("input[name=show_additional_fields]:checked").length&&r.is(t)||"billing_phone_full_number"!==t.attr("name")&&s.push(this))})),s},onStepperClick:function(){e("[data-stepper]").each((function(){e(this).on("click",(async function(t){t.preventDefault(),o.Validations.clearErrorMessages();let i=e(this).data("stepper");if(e(this).closest("[data-stepper-li]").hasClass("selected"))return!1;let n=!1;if(i>1){let t=o.Steps.getFields(e(`[data-step="${i-1}"]`));n=await o.Validations.checkFieldsForErrors(t),n&&console.log("[FLEXIFY CHECKOUT] Field errors: ",n)}return n||(window.location.hash="#"+o.Steps.steps_hash[i],e(document.body).trigger("country_to_state_changed")),!1}))}))},onNextClick:function(){e("[data-step-next]").each((function(){e(this).on("click",(async function(t){t.preventDefault();let i=e(this);o.Components.addSpinner(i),o.Validations.clearErrorMessages();let n=i.closest("[data-step]"),r=o.Steps.getFields(n);if(await o.Validations.checkFieldsForErrors(r)){o.Components.removeSpinner(i),o.Validations.scrollToError();let e=Number(n.attr("data-step"));return o.Steps.disableNextSteppers(e),!1}o.Components.removeSpinner(i);let s=i.data("step-show");return!!e(`[data-step="${s}"]`).length&&(window.location.hash="#"+o.Steps.steps_hash[s],e(document.body).trigger("country_to_state_changed"),!1)}))}))},switchStepper:function(t,i){const n=e(`[data-stepper-li="${t}"]`),r=e(`[data-stepper-li="${i}"]`);n.removeClass("error disabled selected"),n.find("button").removeAttr("disabled aria-disabled"),r.removeClass("error disabled").addClass("selected"),r.find("button").removeAttr("disabled aria-disabled"),o.Steps.completePreviousSteppers(i)},disableNextSteppers:function(t){e("[data-stepper-li]").each((function(){var o=e(this),i=o.data("stepper-li");t===i&&o.removeClass("complete"),t>=i||(o.addClass("disabled").removeClass("complete"),o.find("[data-stepper]").attr({disabled:"disabled","aria-disabled":"true"}))}))},completePreviousSteppers:function(t){e("[data-stepper-li]").each((function(){var o=e(this);o.data("stepper-li")>=t||o.addClass("complete")}))},switchPanels:function(t,o){let i=e(`[data-step="${t}"]`),n=e(`[data-step="${o}"]`);i.css("display","none").attr("aria-hidden","true"),n.css("display","").attr("aria-hidden","false"),e(window).scrollTop(0)},onHashChange:function(t){if(window.location.hash){var i,n,r,s,a;i=window.location.hash.replace("#",""),a=o.Steps.isHashGoingForward(t),i.includes("|")?(r=(n=i.split("|"))[0],s=n[1]):r=i;var c=document.querySelector('[data-hash="'+r+'"]');if(c){var l=c.attributes["data-stepper"].value,d=document.querySelector(".flexify-stepper__step.selected .flexify-stepper__button"),u=d.attributes["data-stepper"].value,p=d.attributes["data-stepper"].value,f=l===u;if(a&&o.Validations.clearErrorMessages(),f)return o.Steps.scrollToElement(s),!1;o.Steps.switchPanels(p,l),o.Steps.switchStepper(p,l),o.Steps.scrollToElement(s),e(document.body).trigger("country_to_state_changed"),e(document.body).trigger("flexify_step_change"),document.getElementById("billing_phone")&&document.getElementById("billing_phone").dispatchEvent(new Event("keyup"))}}},handeStepOnPageLoad:function(){window.location.hash?o.Steps.onHashChange():window.location.hash=o.Steps.steps_hash[1]},findHashIndex:function(e){for(var t in e=e.replace("#",""),this.steps_hash)if(this.steps_hash[t]===e)return t;return!1},isHashGoingForward:function(e){if(!e)return!1;let t=new URL(e.newURL),i=new URL(e.oldURL),n=o.Steps.findHashIndex(t.hash),r=o.Steps.findHashIndex(i.hash);return parseInt(n)>parseInt(r)},scrollToElement:function(t){t&&e(`#${t}`).length&&e("html, body").animate({scrollTop:e(`#${t}`).offset().top-60},"fast")},init:function(){this.handeStepOnPageLoad(),this.onNextClick(),this.onStepperClick(),window.addEventListener("hashchange",o.Steps.onHashChange)}},Fields:{updateInternationalPhoneHiddenField:function(t){let o=e('input[name="billing_phone_full_number"]');o.length||e("#billing_phone").after('<input type="hidden" name="billing_phone_full_number">'),o.val(t)},internationalPhone:function(){const i=e('.flexify-intl-phone input[type="tel"], .flexify-intl-phone input[type="text"]');i.length&&i.each(((i,n)=>{const r=e(n),s=window.intlTelInput(n,{loadUtils:()=>import(t.path_to_utils),autoPlaceholder:"polite",containerClass:"flexify-intl-phone--init",nationalMode:!0,separateDialCode:!0,initialCountry:t.base_country||"br",onlyCountries:t.allowed_countries||["br"],i18n:t.i18n.iti_i18n||{}});r.data("itiInstance",s),r.closest(".form-row").addClass("flexify-intl-phone--init"),s.promise.then((()=>{n.addEventListener("countrychange",(()=>{o.Fields.updateInternationalPhoneHiddenField(s.getNumber())})),r.on("blur",o.Validations.markInternationalPhoneChanged),r.on("blur validate flexify_validate keyup",o.Validations.validateInternationalPhone),r.on("blur validate flexify_validate keyup",(function(){o.Fields.updateInternationalPhoneHiddenField(s.getNumber())})),e("#billing_country").on("change",(function(){const t=e(this).val().toLowerCase();s.setCountry(t),e("#billing_phone").change()})),e("#billing_country").on("change",o.Validations.validateInternationalPhone)})),e("form.checkout").off("input","**")}))},hasPermanentPlaceholder:function(e){const o=e.find("label");if(!o.length)return!1;const i=o.attr("for");return!!["billing_address_info","shipping_address_info",""].includes(i)||"billing_phone"===i&&"yes"===t.international_phone},addRemoveFocusClass:function(){e(document).on("focus",".form-row input",(function(){e(this).closest(".form-row").addClass("form-row--focus")})),e(document).on("blur",".form-row input",(function(){e(this).closest(".form-row").removeClass("form-row--focus")}))},prepareFields:function(){e(".form-row").each((function(){const t=e(this),i=t.find("input, select").first(),n=o.Fields.hasPermanentPlaceholder(t),r=i.is("select")||!!i.val();t.toggleClass("is-active",n||r)}))},toggleField:function(t,o,i,n=!0){const r=e(t),s=r.closest(".form-row");r.prop("required",i),o?(s.removeClass("temp-hidden"),n&&s.addClass("validate-required"),i&&s.addClass("required-field"),s.show()):(n&&s.removeClass("validate-required"),i&&s.addClass("required-field"),s.addClass("temp-hidden").hide())},autoFillAddress:function(i){const n=e(`#${i}_postcode`).val().replace(/\D/g,""),r=["address_1","neighborhood","city","state"].map((e=>{const t=document.getElementById(`${i}_${e}`);return t?.closest("p.form-row")||null})).filter((e=>e));8===n.length&&e.ajax({type:"GET",url:t.fill_address.api_service.replace("{postcode}",n),dataType:"json",contentType:"application/json",beforeSend:function(){o.UI.togglePlaceholder(r,!0)},success:function(e){e&&o.Fields.fillAddressFields(i,e)},error:function(e,t,i){console.error("[FLEXIFY CHECKOUT] AJAX error on try fill address:",t,i),o.UI.togglePlaceholder(r,!1)},complete:()=>{o.UI.togglePlaceholder(r,!1)}})},fillAddressFields:function(o,i){const n=t.fill_address;e(`#${o}_address_1`).val(i[n.address_param]).change(),e(`#${o}_neighborhood`).val(i[n.neightborhood_param]).change(),e(`#${o}_city`).val(i[n.city_param]).change(),e(`#${o}_state`).val(i[n.state_param]).change()},initAutoFillAddress:function(){["billing","shipping"].forEach((t=>{const i=e(`#${t}_postcode`),n=e(`#${t}_address_1`);i.val()&&!n.val()&&o.Fields.autoFillAddress(t),i.on("keyup",(()=>{o.Fields.autoFillAddress(t)}))}))},initCnpjAutofill:function(){e("#billing_cnpj").on("blur",this.getCnpjData.bind(this))},getCnpjData:function(i){const n=e(i.target).val().replace(/\D/g,"");if(14!==n.length)return;const r=["billing_phone","billing_company","billing_postcode","billing_address_1","billing_number","billing_neighborhood","billing_city","billing_state"].map((e=>{const t=document.getElementById(e);return t?t.closest("p.form-row"):null})).filter(Boolean);e.ajax({type:"POST",url:t.ajax_url,data:{action:"cnpj_autofill_query",cnpj:n},beforeSend:function(){o.UI.togglePlaceholder(r,!0)},success:function(e){e.success&&e.data&&o.Fields.fillCnpjFields(e.data,r)},error:function(e,t,i){console.error("[FLEXIFY CHECKOUT] AJAX error on try fill CNPJ data:",t,i),o.UI.togglePlaceholder(r,!1)},complete:function(){o.UI.togglePlaceholder(r,!1)}})},fillCnpjFields:function(t,o){const i={billing_phone:"telefone",billing_company:"nome",billing_postcode:"cep",billing_address_1:"logradouro",billing_number:"numero",billing_neighborhood:"bairro",billing_city:"municipio",billing_state:"uf"};o.forEach((o=>{const n=e("input, select, textarea",o),r=n.attr("id"),s=i[r];if(!s||!t[s])return;let a=t[s];"cep"===s&&(a=a.replace(/\D/g,""),a.length>=8&&(a=a.replace(/(\d{5})(\d{3})/,"$1-$2"))),n.val(a).change()}))},toggleBrazilianMarketFields:function(){const t=e("#billing_country").val(),o=["#billing_persontype_field","#billing_cpf_field","#billing_rg_field","#billing_cnpj_field","#billing_ie_field","#billing_cellphone_field","#billing_birthdate_field","#billing_sex_field","#billing_number_field","#billing_neighborhood_field"].join(",");e(o).toggleClass("d-none","BR"!==t)},init:function(){o.Fields.prepareFields(),o.Fields.addRemoveFocusClass(),e(document).on("change focus keydown",".form-row input, .form-row select, .form-row textarea",(function(){e(this).closest(".form-row").addClass("is-active")})),e(document).on("blur",".form-row input, .form-row select, .form-row textarea",(function(){let t=e(this).closest(".form-row");o.Fields.hasPermanentPlaceholder(t)||e(this).val()||t.removeClass("is-active")})),e(document.body).on("country_to_state_changed",(function(){o.Fields.prepareFields()})),"BR"===e("#billing_country").val()&&"yes"===t.fill_address.enable_auto_fill_address&&t.license_is_valid&&o.Fields.initAutoFillAddress(),"yes"===t.enable_autofill_company_info&&t.license_is_valid&&o.Fields.initCnpjAutofill(),"yes"===t.enable_hide_brazilian_market_fields&&t.license_is_valid&&(e(document).ready(o.Fields.toggleBrazilianMarketFields.bind(this)),e("#billing_country").on("change",o.Fields.toggleBrazilianMarketFields.bind(this))),"yes"===t.international_phone&&t.license_is_valid&&o.Fields.internationalPhone()}},Components:{addSpinner:function(e){e.prop("disabled",!0).addClass("flexify-button--processing")},removeSpinner:function(e){e.prop("disabled",!1).removeClass("flexify-button--processing")},passwordStrengthMeter:function(){"yes"===t.check_password_strenght&&e("#account_password").on("keyup",(function(){let t=e(this).val(),o=e(".woocommerce-password-strength"),i=e(".create-account").find(".password-strength-meter"),n=e(".flexify-button");if(i.removeClass("short bad good strong"),""!==t){if(e(".password-meter").addClass("active"),o.length>0){let e=o.attr("class");e.includes("short")?(i.addClass("short"),n.prop("disabled",!0)):e.includes("bad")?(i.addClass("bad"),n.prop("disabled",!0)):e.includes("good")?(i.addClass("good"),n.prop("disabled",!1)):e.includes("strong")&&(i.addClass("strong"),n.prop("disabled",!1))}}else e(".password-meter").removeClass("active")}))},initSelect2Fields:function(){const o=t.get_new_select_fields||[];e(o).each((function(){"billing_country"!==this&&"shipping_country"!==this&&e("#"+this).select2()}))},updateFragments:function(t){for(var o in t)e(o).length&&e(o).replaceWith(t[o])},accountToggle:function(){e(".woocommerce-account-fields input#createaccount").unbind(),Array.from(document.querySelectorAll(".woocommerce-account-fields input#createaccount")).forEach((function(t){t.addEventListener("change",(function(t){t.preventDefault(),t.stopPropagation();let i=t.target.closest(".woocommerce-account-fields").querySelector("div.create-account");return!!i&&(t.target.checked?(o.UI.slideDown(i),i.setAttribute("aria-hidden","false")):(o.UI.slideUp(i),i.setAttribute("aria-hidden","true")),setTimeout((function(){Array.from(i.querySelectorAll("input, select, textarea")).forEach((function(e){e.closest(".form-row").classList.remove("woocommerce-invalid")}))}),1),e(document.body).trigger("country_to_state_changed"),!1)}))}))},shippingToggle:function(){Array.from(document.querySelectorAll("#ship-to-different-address input")).forEach((function(t){t.addEventListener("change",(function(t){t.preventDefault();var i=t.target.closest(".woocommerce-shipping-fields__wrapper").querySelector(".shipping_address");return t.target.checked?(o.UI.slideDown(i),i.setAttribute("aria-hidden","false")):(o.UI.slideUp(i),i.setAttribute("aria-hidden","true")),e(document.body).trigger("country_to_state_changed"),!1}))}))},orderNotesToggle:function(){Array.from(document.querySelectorAll("#show-additional-fields input")).forEach((function(t){t.addEventListener("change",(function(t){t.preventDefault();var i=t.target.closest(".woocommerce-additional-fields__wrapper").querySelector(".woocommerce-additional-fields");return t.target.checked?(o.UI.slideDown(i),i.setAttribute("aria-hidden","false")):(o.UI.slideUp(i),i.setAttribute("aria-hidden","true")),e(document.body).trigger("country_to_state_changed"),!1}))}))},onCountryChange:function(){window.setTimeout((function(){if(e("#billing_state").length){"SELECT"===e("#billing_state").prop("tag_name")?e("#billing_state").closest(".form-row").attr("data-type","select"):(e("#billing_state").closest(".form-row").attr("data-type","text"),e("#billing_state").attr("placeholder",""))}if(e("#shipping_state").length){"SELECT"===e("#shipping_state").prop("tag_name")?e("#shipping_state").closest(".form-row").attr("data-type","select"):(e("#shipping_state").closest(".form-row").attr("data-type","text"),e("#shipping_state").attr("placeholder",""))}}))},watchCountryChange:function(){e("#billing_country").length?(e("#billing_country, #shipping_country").change((function(){o.Components.onCountryChange()})),o.Components.onCountryChange()):o.Components.onCountryChange()},updateReviewData:function(){document.querySelectorAll(".form-row input, .form-row select, .form-row textarea").forEach((function(t){e(t).on("change input keyup",(function(){let o=t.id.replace("billing_","");e(".flexify-review-customer__content").find(".customer-details-info."+o).html(e(t).val())}))}))},showSuggestions:function(t,o,i){o.empty(),i.forEach((i=>{const n=e("<li>").text(t.val().split("@")[0]+"@"+i).on("click",(function(){t.val(e(this).text()).trigger("change"),o.removeClass("show"),e("button[type='submit']").prop("disabled",!1)}));o.append(n)})),o.addClass("show")},bindEmailSuggestionField:function(o){const i=o.attr("id");let n=t.get_email_providers||{},r=`#flexify_checkout_email_suggest_${i}`;0===e(r).length&&o.after(`<div class="flexify-checkout-email-suggestions" id="flexify_checkout_email_suggest_${i}"></div>`);const s=e(r),a=e("<ul>").addClass("auto-list").appendTo(s);o.on("keyup",(()=>{const e=o.val();if(e.includes("@")){const t=e.split("@")[1]||"",i=n.filter((e=>e.startsWith(t)));i.length?this.showSuggestions(o,a,i):a.removeClass("show")}else a.removeClass("show")})),o.on("blur",(()=>{setTimeout((()=>a.removeClass("show")),200)}))},relocateExpressButtons:function(){const t=e(".flexify-express-checkout-wrap");e("#wc-stripe-payment-request-wrapper>div").each((function(){e(this).appendTo(t).wrap('<div class="flexify-express-checkout__btn flexify-expresss-checkout__btn--stripe flexify-skeleton"></div>')})),e(".eh_paypal_express_link").appendTo(t).wrap('<div class="flexify-express-checkout__btn"></div>')},stripeHideEmptyElement:function(){const t=e(".flexify-express-checkout-wrap");e("#wc-stripe-payment-request-button").length&&(e(".flexify-expresss-checkout__btn--stripe").addClass("flexify-skeleton"),setTimeout((function(){e("#wc-stripe-payment-request-button div").length||e("#wc-stripe-payment-request-button").hide(),e(".flexify-expresss-checkout__btn--stripe").removeClass("flexify-skeleton"),t.find(">div,>span,>a").length<2&&0==e("#wc-stripe-payment-request-button>div").length&&t.hide()}),3e3))},addNotice:function(t){e(".woocommerce-notices-wrapper").append(t)},removeNotice:function(){e(document).on("click",".close-notice",(function(t){t.preventDefault();let o=e(this);var i=o.closest(".flexify-checkout-notice");i.length>=1?(i.addClass("removing-notice").fadeOut("fast"),setTimeout((function(){e(".flexify-checkout-notice.removing-notice").remove()}),500)):(o.parent("li").parent("ul.woocommerce-error").addClass("removing-notice").fadeOut("fast"),setTimeout((function(){e(".woocommerce-error.removing-notice").remove()}),500))}))},init:function(){this.initSelect2Fields(),this.passwordStrengthMeter(),this.accountToggle(),this.shippingToggle(),this.orderNotesToggle(),this.watchCountryChange(),this.updateReviewData(),this.relocateExpressButtons(),this.stripeHideEmptyElement(),this.removeNotice(),e("html").removeClass("no-js"),"yes"===t.enable_emails_suggestions&&e('p.form-row[data-type="email"] input').each(((t,o)=>{this.bindEmailSuggestionField(e(o))}))}},UI:{slideDown:function(e){"block"!==e.style.display&&(e.style.height=0,e.classList.add("slide-down"),e.style.display="block",e.style.height=`${e.scrollHeight}px`,setTimeout((function(){e.classList.remove("slide-down"),e.style.height=""}),500))},slideUp:function(e){"none"!==e.style.display&&(e.style.height=`${e.scrollHeight}px`,e.classList.add("slide-up"),setTimeout((function(){e.style.height=0}),10),setTimeout((function(){e.style.display="none",e.classList.remove("slide-up"),e.style.height=""}),500))},togglePlaceholder:function(t,o){e(t).each((function(){e(this).toggleClass("flexify-checkout-loading-placeholder",o)}))}},Shippings:{maybeShowShippingForm:function(t){if(e("#ship-to-different-address-checkbox").is(":checked")&&t){var o=!1;t.forEach((e=>{e.includes("shipping_")&&(o=!0)})),o&&(e(".shipping-address-search").slideUp(),e(".woocommerce-shipping-fields").slideDown())}},addShippingRowOnSummary:function(t){0===e("#flexify-checkout-summary-shipping-row").length&&e("#order_review > table > tfoot tr.cart-subtotal").after('<tr id="flexify-checkout-summary-shipping-row"></tr>');let o=t?.fragments?.flexify?.shipping_row;o&&o.length>0&&e("#flexify-checkout-summary-shipping-row").html(o)},countryChanges:function(){e("select.country_select").on("select2:open",(function(t){e(".select2-dropdown--above").length<=0||e(this).closest(".form-row").find("label").hide()})).on("select2:close",(function(t){e(this).closest(".form-row").find("label").show()}))},selectShippingMethod:function(){e(".shipping-method-item").removeClass("selected-method"),e("input.shipping_method:checked").closest(".shipping-method-item").addClass("selected-method")},init:function(){this.countryChanges()}},Payments:{changePaymentMethod:function(){e(document.body).on("change",'input[name="payment_method"]',(function(){e(document.body).trigger("update_checkout")}))},init:function(){this.changePaymentMethod()}},Session:{debounce:function(e,t){let o;return function(){const i=this,n=arguments;clearTimeout(o),o=setTimeout((()=>e.apply(i,n)),t)}},update:function(){const o=t.get_all_checkout_fields||[],i=[];e(o).each((function(t,o){o&&e.each(o,(function(t,o){let n=e("#"+t).val();void 0!==n&&i.push({field_id:t,value:n})}))})),e.ajax({type:"POST",url:t.ajax_url,data:{action:"get_checkout_session_data",fields_data:JSON.stringify(i),ship_to_different_address:e("#ship-to-different-address-checkbox").is(":checked")?"yes":"no"},error:function(e,t,o){console.error("[FLEXIFY CHECKOUT] AJAX error on try session update data:",t,o)}})},init:function(){const i=t.get_all_checkout_fields||{},n=this.debounce(this.update.bind(this),500);o.Session.update(),e.each(i,((t,o)=>{o.billing&&e.each(o.billing,(t=>{e("#"+t).on("change input",n)}))})),e(".flexify-button[data-step-next]").on("click",(function(e){e.preventDefault(),o.Session.update()}))}},Conditions:{checkCondition:function(e,t,o=""){switch(e){case"is":return t===o;case"is_not":return t!==o;case"empty":return""===t;case"not_empty":return""!==t;case"contains":return-1!==t.indexOf(o);case"not_contain":return-1===t.indexOf(o);case"start_with":return t.startsWith(o);case"finish_with":return t.endsWith(o);case"bigger_then":return parseFloat(t)>parseFloat(o);case"less_than":return parseFloat(t)<parseFloat(o);case"checked":return"object"==typeof t?!!t.checked:!!t;case"not_checked":return"object"==typeof t?!t.checked:!t;default:return!1}},checkFieldVisibility:function(){Object.values(t.field_condition||{}).forEach((t=>{const o=e("#"+t.component_field),i=o.closest(".form-row"),n=e("#"+t.verification_condition_field),r=n.is(":checkbox")?n.is(":checked"):n.val(),s=this.checkCondition(t.condition,r,t.condition_value);"show"===t.type_rule&&"field"===t.verification_condition?s?(o.prop("required",!0),i.removeClass("temp-hidden").addClass("validate-required required-field").show()):(o.prop("required",!1),i.removeClass("required-field woocommerce-invalid validate-required").addClass("temp-hidden").hide()):"hide"===t.type_rule&&(s?(o.prop("required",!1),i.removeClass("required required-field woocommerce-invalid validate-required").addClass("temp-hidden").hide()):(o.prop("required",!0),i.removeClass("temp-hidden").addClass("validate-required required-field").show()))})),e("label.has-condition.required-field > span.optional").remove(),e("label.has-condition.required-field").each((function(){e(this).find("abbr.required").length||e(this).append(`<abbr class="required" title="${t.i18n.required_field}">*</abbr>`)}))},init:function(){(t.field_condition||[]).forEach((t=>{const o="#"+t.verification_condition_field;e(document).on("change input keyup",o,(()=>{this.checkFieldVisibility(),e("form.checkout").trigger("update_checkout").trigger("wc_fragment_refresh")}))})),this.checkFieldVisibility()}},Compatibility:{compatSalesBooster:function(){Array.from(document.querySelectorAll("[data-flexify-wsb-checkout-bump-trigger]")).forEach((function(t){t.addEventListener("change",(function(){e("[data-flexify-wsb-checkout-bump-trigger]").trigger("change")}))}))},compatDeliverySlots:function(){window.setTimeout((function(){e("#jckwds-delivery-date, #jckwds-delivery-time").on("validate",(function(t){"1"===e("[name=flexify-wds-fields-hidden]").val()&&(e(t.target).closest(".form-row").removeClass("woocommerce-invalid"),t.stopPropagation())}))}))},updatePersonTypeFields:function(){const i=e("#billing_persontype");let n=(e("#billing_country").val()||"").toString().toUpperCase();if(!i.length)return;const r=function(e){const t=parseInt(e,10);return Number.isNaN(t)?1:t}(i.val()),s=t.get_all_checkout_fields||{},a=function(e){if(!t.bmw_settings)return!1;const o=t.bmw_settings.only_brazil;return"1"===o||1===o||"yes"===o||!0===o}(),c="BR"===n,l=function(e){const t=!(!0!==s[e]?.required);return!a||c||t},d=1===r&&l("billing_cpf"),u=l("billing_rg")||!1,p=2===r&&l("billing_cnpj"),f=l("billing_ie")||!1,m=2===r&&l("billing_company");o.Fields.toggleField("#billing_cpf",1===r,d,!0),o.Fields.toggleField("#billing_rg",1===r,u,!1),o.Fields.toggleField("#billing_cnpj",2===r,p,!0),o.Fields.toggleField("#billing_ie",2===r,f,!1),o.Fields.toggleField("#billing_company",2===r,m,!1)},initPersonTypeFields:function(){const t=this.updatePersonTypeFields.bind(this);e(document).on("change","#billing_persontype, #billing_country",t),t()},init:function(){this.compatSalesBooster(),this.compatDeliverySlots(),this.initPersonTypeFields(),e(window).on("pageshow",(function(){o.Fields.prepareFields()})),e(".address-field input.input-text").on("input propertychange paste",(function(){e(this).trigger("keydown")}))}},Countdown:{timer:null,initial:0,remaining:0,element:null,action:"",storageKey:"flexify_checkout_countdown_expire_at",init:function(){if("yes"===t.countdown_enabled){var o=t.countdown_target_selector||"#flexify-checkout-countdown .time";if(!e(o).length){var i='<div id="flexify-checkout-countdown" class="flexify-checkout-countdown" aria-live="polite"><span class="title">'+(t.countdown_title||"Sua sess√£o termina em:")+' </span><strong class="time">00:00</strong></div>';e(".flexify-checkout__content").first().before(i)}this.element=e(o);var n=parseInt(t.countdown_value,10)||0,r=String(t.countdown_unit||"seconds").toLowerCase();this.initial=function(e,t){switch(t){case"minute":case"minutes":return 60*e;case"hour":case"hours":return 3600*e;default:return e}}(n,r),this.remaining=this.initial,this.action=t.countdown_action||"hide";var s=parseInt(localStorage.getItem(this.storageKey),10)||0,a=Math.floor(Date.now()/1e3);s>a?this.remaining=s-a:(this.remaining=this.initial,s=a+this.initial,localStorage.setItem(this.storageKey,s)),this.initial>0&&this.start()}},start:function(){const e=this;clearInterval(this.timer),this.display(),this.timer=setInterval((function(){e.remaining--,e.display(),e.remaining<=0&&(clearInterval(e.timer),e.onExpire())}),1e3)},display:function(){if(this.element&&this.element.length){var e=Math.floor(this.remaining/60),t=this.remaining%60,o=function(e){return String(e).padStart(2,"0")},i=o(e)+":"+o(t);this.element.text(i)}},reset:function(){this.remaining=this.initial,this.start()},onExpire:function(){switch(localStorage.removeItem(this.storageKey),e(document).trigger("flexify_checkout_countdown_expired",this.action),this.action){case"hide":this.element&&this.element.length&&this.element.hide();break;case"restart":this.reset();break;case"destroy_session":e.post(t.ajax_url,{action:"flexify_checkout_destroy_session"}).always((()=>{this.redirectUrl&&(window.location.href=this.redirectUrl)}))}}},init:function(){if(this.__inited)return;this.__inited=!0;const e=!(!window.flexify_checkout_params||!window.flexify_checkout_params.debug_mode),t=e?(...e)=>console.log("[Flexify Checkout]",...e):()=>{};e&&console.log("[Flexify Checkout] Loaded params:",window.flexify_checkout_params||{});const o=(e,o)=>{try{o&&"function"==typeof o.init&&(o.init(),t("init:",e))}catch(t){console.error(`[Flexify] ${e}.init() falhou:`,t)}},i=[["localStorage",this.localStorage],["Compatibility",this.Compatibility],["Triggers",this.Triggers],["loginForm",this.loginForm],["Steps",this.Steps],["Fields",this.Fields],["Payments",this.Payments],["Coupons",this.Coupons]],n=[["Sidebar",this.Sidebar],["Components",this.Components],["Conditions",this.Conditions],["Session",this.Session],["Validations",this.Validations],["Countdown",this.Countdown],["processCheckout",this.processCheckout]];i.forEach((([e,t])=>o(e,t))),setTimeout((()=>n.forEach((([e,t])=>o(e,t)))),0)}};e(document).ready((function(){o.init()})),window.Flexify_Checkout=o,e(document).trigger("flexify_checkout_ready")}(jQuery);